# Import module for Boost support.
import boost
  ;

# Use Boost libraries.
boost.use-project
  ;
 
# Use AsmJit library. 
use-project /asmjit
  :
    deps/asmjit
  ;
  
# Use udis86 library. 
use-project /udis86
  :
    deps/udis86
  ;
 
# Use PugiXML library. 
use-project /pugixml
  :
    deps/pugixml
  ;
  
# Use TCLAP library. 
use-project /tclap
  :
    deps/tclap
  ;
  
# Use AntTweakBar library. 
use-project /anttweakbar
  :
    deps/anttweakbar
  ;
  
# Use GWEN library. 
use-project /gwen
  :
    deps/gwen
  ;
  
# Use HadesMem tests.
use-project /tests
  :
    tests
  ;

# Use HadesMem examples.
use-project /examples
  :
    examples
  ;

project memory
  :
    requirements
    
    # Enforce strict Windows typedefs.
    <define>STRICT
    <define>STRICT_TYPED_ITEMIDS
    
    # Force use of Unicode APIs, entry point, etc.
    <define>UNICODE
    <define>_UNICODE
    
    # Disable warnings about use of 'unsafe' CRT and STL functions.
    <define>_CRT_SECURE_NO_WARNINGS
    <define>_SCL_SECURE_NO_WARNINGS
    
    # Minimum supported OS is Windows Vista
    <define>WINVER=0x0601
    <define>_WIN32_WINNT=0x0601
    
    # Disable tracing on release builds
    <variant>release:<define>HADESMEM_NO_TRACE
    
    # Compile for x86/x64, with static linking to the multi-threaded runtime.
    <architecture>x86
    <threading>multi
    <runtime-link>shared
    
    # Disable warning relating to the length of decorated names caused by 
    # some Boost components. This warning can safely be ignored as it does 
    # not affect program correctness.
    <cxxflags>"/wd4503"

    # Disable behavior change 'warning', "an object of POD type constructed 
    # with an initializer of the form () will be default-initialized". This 
    # warning can be safely ignored as it's just a notification about a 
    # deficiency in the compiler, it doesn't indicate a problem with the code.
    <cxxflags>"/wd4345"
    
    # Enable LTO/LTCG 
    <variant>release:<cxxflags>"/GL"
    <variant>release:<linkflags>"/LTCG"

    # Enable more MSVC optimizations
    <variant>release:<cxxflags>"/Gw /Gy"
    
    # Improve standards conformance under MSVC
    <cxxflags>"/Zc:rvalueCast"
    <cxxflags>"/volatile:iso"
        
    # Enable generation of debugging symbols, even under release mode.
    <debug-symbols>on
    
    # This (undocumented) flag vastly improves the PDBs generated by MSVC for 
    # optimized code. Code-gen is not affected, the only downside is that the 
    # size of the PDB is increased.
   <variant>release:<cxxflags>/d2Zi+

    # Make MSVC x86 binaries large address aware
    <address-model>32:<linkflags>/LARGEADDRESSAWARE
  :
    # Build under debug mode by default.
    default-build debug
  :
    # Output to 'bin' directory.
    build-dir bin
  ;
  
lib advapi32
  :
  :
    <name>advapi32
  ;
  
lib shell32
  :
  :
    <name>shell32
  ;

lib shlwapi
  :
  :
    <name>shlwapi
  ;

lib user32
  :
  :
    <name>user32
  ;
  
alias memory
  :
  :
  :
  :
    <library>advapi32
    <library>shell32
    <library>shlwapi
    <library>user32
	
    <implicit-dependency>/boost//headers
	
    <library>deps/asmjit

    <library>deps/udis86

    <library>deps/pugixml

    <library>deps/tclap

    <library>deps/anttweakbar

    <library>deps/gwen

    <include>"./include/memory"
  ;

# Build HadesMem tests.
build-project tests
  ;

# Build HadesMem examples.
build-project examples
  ;

# Install to 'dist' directory.
install dist
  :
    # Install examples.
    examples
  :
    # Give each toolset, variant, and architecture combination its own 
    # directory.
    
    <variant>debug,<address-model>32:<location>dist/debug/x86
    <variant>debug,<address-model>64:<location>dist/debug/x64
    <variant>release,<address-model>32:<location>dist/release/x86
    <variant>release,<address-model>64:<location>dist/release/x64
    
    # Automatically pull in dependencies.
    <install-dependencies>on
    
    # Install both EXEs and DLLs.
    <install-type>EXE
    <install-type>SHARED_LIB
    <install-type>PDB
    <install-type>LIB
  ;

# Allow easy consumption by 3rd parties.
alias hadesmem
  :
    memory
  ;
  
# Allow easy consumption by 3rd parties.
alias cerberus
  :
    /examples//cerberus
  ;
